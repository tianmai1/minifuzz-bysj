## Makefile for building triage test binaries for ARM platform.
## The explicitly declared file targets below may cause Makefile warnings
## due to redefinition -- this is a known issue. They may safely be ignored.
BIN_DIR=./bin
TEST_FILE_EXT=.test

CC?=arm-none-linux-gnueabi-gcc -g
CXX?=arm-none-linux-gnueabi-g++ -g

C_SRC=$(wildcard *.c)
CPP_SRC=$(wildcard *.cpp)

C_TESTS=$(C_SRC:.c=$(TEST_FILE_EXT))
CPP_TESTS=$(CPP_SRC:.cpp=$(TEST_FILE_EXT))
EXCLUDE=testBranchAv.test testBlockMoveAv.test testDestAv.test testDestAvNearNull.test testSourceAvNearNull.test
TESTS=$(filter-out $(EXCLUDE), $(C_TESTS) $(CPP_TESTS))

all: $(TESTS)

$(TESTS): | $(BIN_DIR)

$(BIN_DIR):
	mkdir $(BIN_DIR)

$(C_TESTS): %$(TEST_FILE_EXT): %.c
	$(CC) -o $(BIN_DIR)/$@ $<

$(CPP_TESTS): %$(TEST_FILE_EXT): %.cpp
	$(CXX) -o $(BIN_DIR)/$@ $<

.PHONY: clean
clean:
	-rm $(addprefix $(BIN_DIR)/,$(TESTS))
	-rmdir $(BIN_DIR)
